<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Mini Project 2: Get Ur Gait On</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL 5380</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Mini-Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mini_projects.html">Mini-Projects Overview</a>
    </li>
    <li>
      <a href="MP1.html">MP1 Description</a>
    </li>
    <li>
      <a href="MP2.html">MP2 Description</a>
    </li>
    <li>
      <a href="MP3.html">MP3 Description</a>
    </li>
    <li>
      <a href="MP4.html">MP4 Description</a>
    </li>
    <li>
      <a href="MP5.html">MP5 Description</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Final Project
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="final_project.html">FP Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/orgs/bcbiomech/teams/biol5380_s22/discussions">Discussion Board</a>
</li>
<li>
  <a href="https://bostoncollege.instructure.com/courses/1627355">Course Canvas Page</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Mini Project 2: Get Ur Gait On</h1>

</div>


<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"></p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Our second Miniproject explores several topics in the biomechanical basis of terrestrial locomotion. In particular, we’ll focus on how well the inverted pendulum model applies in predicting the maximum speed of walking humans and to what extent some kinematic variables, like pelvic tilt, contribute to differences in speed. We’ll also look at how these kinematic variables vary by size and sex. Our general goals are to:</p>
<ul>
<li>Use imageJ to perform kinematic analysis</li>
<li>Use simple mathematical models to predict maximum limb walking speed</li>
<li>Test predictions of walking speed with measurements and observations</li>
<li>Evaluate the effects sex and size (scaling!) on your observations</li>
</ul>
<div class="figure" style="text-align: center">
<img src="pend.png" alt="The inverted pendulum model of bipedal locomotion" width="332" />
<p class="caption">
The inverted pendulum model of bipedal locomotion
</p>
</div>
<div id="conceptual-basis" class="section level3">
<h3>Conceptual basis</h3>
<p>As we’ve learned, the inverted pendulum (IP) is rather simple model for understanding how we walk. Under the IP model, the leg forms the radius of an arc through which your center of mass (COM) travels. Thus, we can use concepts surrounding centripetal forces to estimate how fast we walk. So far, we’ve ignored air resistance and the inertial effects of other moving parts (e.g., arms) and assumed the leg is rigid and rotates about the ground at a single point of contact. Under these conditions, we can make predictions as to the maximum linear velocity of our COM. The force associated with this swinging pendulum can be described as</p>
<p><span class="math display">\[
F =ma_c=\frac {mv^2}{R} 
\]</span></p>
<p>where <span class="math inline">\(a_c\)</span> the acceleration due to gravity and <span class="math inline">\(R\)</span> is the leg length, or the radius of the inverted pendulum. From this we see that the maximum velocity of the rotating mass is never greater than the square root of the product of gravity and the radius, or, in biomechanical terms</p>
<p><span class="math display">\[
v_{max}^2 \leq gl
\]</span></p>
<p><span class="math display">\[
v_{max} \leq\sqrt{ gl}
\]</span></p>
<p>where <span class="math inline">\(g\)</span> is gravity and <span class="math inline">\(l\)</span> the leg length. Thus, as we have learned in class, the Froude efficiency for walking is:</p>
<p><span class="math display">\[
Fr =\frac {v^2}{gL}&lt;=1 
\]</span></p>
<p>where <span class="math inline">\(v\)</span> and any walking velocity is less or equal to than <span class="math inline">\(v_{max}\)</span>.</p>
<p>As has become clear in our class discussions and demonstrations, the leg length is the radius and any increase in this length will result in a greater velocity. In addition, any biomechanical mechanism that increases the leg length during otherwise lower phases of the arc (e.g., lateral pelvic tilt, that is lifting the plant-leg side of the pelvis, ) will keep the COM higher and increase the velocity.</p>
<div class="figure" style="text-align: center">
<img src="pelvictilt.jpg" alt="A walker tilting its pelvis" width="306" />
<p class="caption">
A walker tilting its pelvis
</p>
</div>
</div>
</div>
<div id="methods" class="section level2">
<h2>Methods</h2>
<p>There are two parts to this MP: (1) predicting and testing predictions of maximum walking speed and (2) an analysis of pelvic tilt as it varies between normal walking at comfortable speeds and fast speeds. For both parts of this MP, it is important that you walk and not run. That means a duty factor of &gt;0.5, i.e., you’ll always have a foot on the ground. Lab partners, police your colleagues to ensure this.</p>
<div id="sofware-essentials" class="section level3">
<h3>Sofware essentials</h3>
<p>We’ll need a few pieces of software to analyze the kinematics of walking. First, <a href="https://imagej.nih.gov/ij/download.html">download and install imageJ</a>, a free image analysis package that just about everyone in the natural sciences uses at one point in their career. Second, download the following two plugin jar-files: <a href="https://imagescience.org/meijering/software/download/MTrackJ_.jar">MTrackJ_.jar (version 1.5.1)</a> and <a href="https://imagescience.org/meijering/software/download/imagescience.jar">imagescience.jar (version 3.0.0)</a>. Then install them to imageJ by selecting “Plugins” <span class="math inline">\(\rightarrow\)</span> “Install” and navigating to these jar files and selecting “open.” MTrackJ is a simple tracking plugin that allows users to track points across video frames.</p>
<p>We’ll be working with video data captured with our phones. The file types associated with videos shot by phones are often unworkable in imageJ. We need a way of converting your phone videos to AVI format, a file type that imageJ can open. Videos can be rendered into AVI files using—you guessed it—free and open source tools like MPEG Streamclip, which <a href="http://www.squared5.com/">can be downloaded here</a></p>
</div>
<div id="max-out-your-pendulum" class="section level3">
<h3>Max out your pendulum</h3>
<p>For this part of the MP you will compare a predicted maximum walking velocity (<span class="math inline">\(v_{max}\)</span>) to observed maximum walking speed. First things first: mark off a distance of 5 meters on level ground (e.g., in the hall, atrium, etc.).</p>
<p>With your knees locked and your hands by your side and not swinging, walk on your heels as fast as you can across the the marked distance. Concentrate on not using any movement in your pelvis or knees. This may require some practice. You may, if you’re careful, have a lab partner push you gently to get you going at the start of the 5-m field. With a phone or watch, record the time it takes to traverse the 5-m distance.</p>
<p>Using these data, compute the velocity (in m s<span class="math inline">\(^{-1}\)</span>) and compare this to your calculated <span class="math inline">\(v_{max}\)</span> based on theory. Please enter these data <a href="https://docs.google.com/spreadsheets/d/13_dIyeWHcFt_7bKkLkgFhfY0IRjRBRmlI9y5xj2Juhc/edit?usp=sharing"><strong>HERE</strong></a>. They can be accessed here for later analysis as well.</p>
</div>
<div id="full-tilt-walking" class="section level3">
<h3>Full-tilt walking</h3>
<p>The radius of your rotating mass can be effectively increased by subtle changes in posture, including active alterations in pelvic position. Lateral pelvic tilt is one such mechanism and the angle of tilt can be measured using ImageJ. While pelvic tilt results in a lengthening of the plant-leg, there are other postural consequences.</p>
<p>Start with donning the markers and the yardstick with markers attached at its end as in the figure below. Attach one small marker low on the front of your shin. Attach the yardstick with binder clips to your pantwaist. Be sure that the yard stick rests right above your anterior superior illiac spines (those bony points on the front of your hip). This apparatus will amplify your pelvic motions and make data recording much easier. Have a project partner record video (in normal video mode) of your walk as you walk toward her/him over the 5-m course from the earlier experiment. Be careful that the full width of the yardstick in the frame at all times. You’ll perform two trials per partner: (1) walking normally at a comfortable speed and (2) walking normally but as quickly as possible. For both trials, use ImageJ and the MTrackJ plugin to track the markers on your body. From these data, you should compute two things: pelvic tilt angle (i.e. the difference between the maximum and minimum tilt angle) and the angle of the leg relative to the COM (the point below the navel. Please also enter these data <a href="https://docs.google.com/spreadsheets/d/13_dIyeWHcFt_7bKkLkgFhfY0IRjRBRmlI9y5xj2Juhc/edit?usp=sharing">here</a>. Remember, these data can be accessed for analysis from this directory. Also notice there are data from previous iterations of the class. Be sure to use all of these in your analysis.</p>
<p>To analyze your videos in ImageJ, you’ll need to convert them to and AVI file and have the MtrackJ plugin installed (see above). Once the AVI file is stored in a directory, open it with ImageJ (File<span class="math inline">\(\rightarrow\)</span> Import <span class="math inline">\(\rightarrow\)</span> AVI . . .). Launch the MTrackJ plugin (Plugins <span class="math inline">\(\rightarrow\)</span> MtrackJ) and follow the directions from the online <a href="http://www.imagescience.org/meijering/software/mtrackj/quickstart/">manual</a>. The goal here is to track four positions and calculate your two kinematic values: pelvic tilt and leg angle.</p>
<div class="figure" style="text-align: center">
<img src="walkfront.png" alt="You lookin' all marked and stuff" width="258" />
<p class="caption">
You lookin’ all marked and stuff
</p>
</div>
</div>
</div>
<div id="what-to-address-in-the-report" class="section level2">
<h2>What to address in the report</h2>
<ol style="list-style-type: decimal">
<li>How did class-wide <span class="math inline">\(v_{max}\)</span> compare to actual class-wide walking speed? Were any patterns related to this revealed by calculating the Froude number?</li>
<li>How does pendulum walking speed (<span class="math inline">\(v_{max}\)</span>) vary with human size and sex? <!-- for future . . . How does actual recorded maximum pendulum walking speed ($v_{max}$) vary with human size and sex?  --></li>
<li>How does pelvic tilt change with increased walking speeds. What is the biomechanical basis for this?</li>
<li>Does pelvic tilt at comfortable walking speeds vary with human size (i.e., mass and height) and sex?</li>
</ol>
<p>As a group, please synthesize the results of your experiments and address these questions in a report in markdown format that follows the structure outlined on our <a href="mini_projects.html">Min-projects page</a>. Reports and any data files reference by them are due Wedneday, February 16th, by 11:59 PM. They can should be sent to Prof. Kenaley in a zipped directory over email.</p>
</div>
<div id="a-kick-start" class="section level2">
<h2>A kick start</h2>
<p>To answer these questions, you’ll have to concatenate a bunch of data. Fortunately, we’ve learned how to do this lately. However, for it to proceed smoothly, you might need some guidance, especially dealing with the data from the MTrackJ analysis. Let’s assume you produced 4 files for two teammates that each walked fast and slowly. If we had our data file names begin with “walk” and end in “.txt,” we could use a handy <code>grep</code> search to find all the files we want to analyze in the directory.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>walk.files <span class="ot">&lt;-</span> <span class="fu">list.files</span>()[<span class="fu">grep</span>(<span class="st">&quot;walk_.*.txt&quot;</span>,<span class="fu">list.files</span>())]</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(walk.files)</span></code></pre></div>
<pre><code>## [1] &quot;walk_fast_me.txt&quot;  &quot;walk_fast_you.txt&quot; &quot;walk_slow_me.txt&quot; 
## [4] &quot;walk_slow_you.txt&quot;</code></pre>
<p>Notice how they are similarly named “walk_speed_subject.txt.” That familiar convention of adding metadata to the filename makes it easy to extract “data about the data” from the file names. Now, as we did in the first , let’s concatenate all the data into one data frame for subsequent plotting and analysis.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>walk.dat <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co">#make a list for storing</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> walk.files){</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  walk.i <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(i,<span class="at">delim=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>) <span class="co">#read data as a tibble</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  met.dat <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(i,<span class="st">&quot;_&quot;</span>)) <span class="co">#split i for metadata and unlist it</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  speed <span class="ot">&lt;-</span> met.dat[<span class="dv">2</span>] <span class="co">#get speed</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  subject <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;.txt&quot;</span>,<span class="st">&quot;&quot;</span>,met.dat[<span class="dv">3</span>]) <span class="co">#remove &quot;.txt&quot; </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  walk.dat[[i]] <span class="ot">&lt;-</span> walk.i<span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">speed=</span>speed,<span class="at">subject=</span>subject)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Rows: 150 Columns: 14</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## dbl (12): Nr, TID, PID, x [pixel], y [pixel], t [sec], I [val], Len [pixel],...
## lgl  (2): D2R [pixel], v [pixel/sec]</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## Rows: 150 Columns: 14</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## dbl (12): Nr, TID, PID, x [pixel], y [pixel], t [sec], I [val], Len [pixel],...
## lgl  (2): D2R [pixel], v [pixel/sec]</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## Rows: 150 Columns: 14</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## dbl (12): Nr, TID, PID, x [pixel], y [pixel], t [sec], I [val], Len [pixel],...
## lgl  (2): D2R [pixel], v [pixel/sec]</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## Rows: 150 Columns: 14</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## dbl (12): Nr, TID, PID, x [pixel], y [pixel], t [sec], I [val], Len [pixel],...
## lgl  (2): D2R [pixel], v [pixel/sec]</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>walk.dat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,walk.dat)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(walk.dat)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 16
##      Nr   TID   PID `x [pixel]` `y [pixel]` `t [sec]` `I [val]` `Len [pixel]`
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1     1     1     1        200.        252.         0       255         0    
## 2     2     1     2        200.        253.         0       255         0.31 
## 3     3     1     3        200.        253.         0       251         0.589
## 4     4     1     4        200.        253.         0       246         0.91 
## 5     5     1     5        199.        253.         0       241         1.17 
## 6     6     1     6        199.        254.         0       255         1.42 
## # … with 8 more variables: `D2S [pixel]` &lt;dbl&gt;, `D2R [pixel]` &lt;lgl&gt;,
## #   `D2P [pixel]` &lt;dbl&gt;, `v [pixel/sec]` &lt;lgl&gt;, `? [deg]` &lt;dbl&gt;,
## #   `?? [deg]` &lt;dbl&gt;, speed &lt;chr&gt;, subject &lt;chr&gt;</code></pre>
<p>Sweet. But, notice that the column names given to the data are gobblygook with all those spaces in and “[pixel]” and “[sec]” in there. Let’s change them for easy referencing with a <code>str_remove()</code> (remove string) operation from the<code>stringr</code> package loaded with <code>tidyverse</code> . . .</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(walk.dat) <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(<span class="fu">colnames</span>(walk.dat),<span class="st">&quot; </span><span class="sc">\\</span><span class="st">[pixel</span><span class="sc">\\</span><span class="st">]| </span><span class="sc">\\</span><span class="st">[sec</span><span class="sc">\\</span><span class="st">]&quot;</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(walk.dat)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 16
##      Nr   TID   PID     x     y     t `I [val]`   Len   D2S D2R      D2P
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;  &lt;dbl&gt;
## 1     1     1     1  200.  252.     0       255 0     0     NA    NA    
## 2     2     1     2  200.  253.     0       255 0.31  0.31  NA     0.31 
## 3     3     1     3  200.  253.     0       251 0.589 0.589 NA     0.279
## 4     4     1     4  200.  253.     0       246 0.91  0.908 NA     0.321
## 5     5     1     5  199.  253.     0       241 1.17  1.16  NA     0.256
## 6     6     1     6  199.  254.     0       255 1.42  1.41  NA     0.249
## # … with 5 more variables: `v [pixel/sec]` &lt;lgl&gt;, `? [deg]` &lt;dbl&gt;,
## #   `?? [deg]` &lt;dbl&gt;, speed &lt;chr&gt;, subject &lt;chr&gt;</code></pre>
<p>That’s better. Now, let’s pare down the data to those columns we actually care about, “x” and “y,” the x and y positions of the points, “subject,” and “speed.” Also notice that the MTrackJ file contains a “TID” and “PID” column identifying to what track (which dot in the image) and point (the series of positions) to which the x and y positions belong. So let’s keep these columns, too, then dump the others, and give it a quick plot with ggplot.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>walk.dat2 <span class="ot">&lt;-</span> walk.dat<span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TID,PID,x,y,subject,speed)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>walk.dat2<span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x,y,<span class="at">col=</span>speed))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">facet_grid</span>(subject<span class="sc">~</span>.)</span></code></pre></div>
<p><img src="MP2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Notice that our leg point (TID=3) is higher than the hip. That’s odd! Well, not really. Convention holds that pixel 0,0 is the upper left of the image, so that means the coordinates are flipped vertically in our images. So let’s flip them back by finding the absolution value each y value minus the maximum y position (the image height).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>walk.dat2 <span class="ot">&lt;-</span> walk.dat2<span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speed,subject)<span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y=</span><span class="fu">abs</span>(y<span class="sc">-</span><span class="fu">max</span>(y)))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>walk.dat2<span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x,y,<span class="at">col=</span>speed))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">facet_grid</span>(subject<span class="sc">~</span>.)<span class="co">#grid it with columns = to speed</span></span></code></pre></div>
<p><img src="MP2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>OK, all well ’n good. But does it make sense to identify our tracked points by “TID,” that is 1, 2, and 3? Wouldn’t it be better to change this to some character description like “hipR,” “hipC,” and “legR,” for right hip, center of the hip, and right leg, respectively. Let’s do it by changing TID to these strings using a series of mutate operations that replace each TID value. (if you do this, confirm the order is correct!)</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>walk.dat2 <span class="ot">&lt;-</span> walk.dat2<span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TID=</span><span class="fu">replace</span>(TID, TID<span class="sc">==</span><span class="dv">1</span>, <span class="st">&quot;hipR&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TID=</span><span class="fu">replace</span>(TID, TID<span class="sc">==</span><span class="dv">2</span>, <span class="st">&quot;hipC&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TID=</span><span class="fu">replace</span>(TID, TID<span class="sc">==</span><span class="dv">3</span>, <span class="st">&quot;legR&quot;</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(walk.dat2)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
## # Groups:   speed, subject [1]
##   TID     PID     x     y subject speed
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;
## 1 hipR      1  200.  178. me      fast 
## 2 hipR      2  200.  178. me      fast 
## 3 hipR      3  200.  178. me      fast 
## 4 hipR      4  200.  178. me      fast 
## 5 hipR      5  199.  177. me      fast 
## 6 hipR      6  199.  177. me      fast</code></pre>
<p>Now it’ll be easier to keep track of which track we intend to reference in any plotting or analysis.</p>
<p>With the data loaded, let’s think about what sort of operations you need to produce on this data set. You need angle for pelvic tilt, right? The angle subtended by the tip of the of our meter-stick amplifiers and the center of the pelvis (<span class="math inline">\(\theta\)</span>) can be described in the following:</p>
<div class="figure" style="text-align: center">
<img src="img/tiltcalc.png" alt="A look at the coordinates of the amplified pelvic positions" width="324" />
<p class="caption">
A look at the coordinates of the amplified pelvic positions
</p>
</div>
<p>where points <span class="math inline">\(x_1y_1\)</span>, <span class="math inline">\(x_2y_2\)</span>, and <span class="math inline">\(x_2y_1\)</span> respectively describe the coordinates of the pelvic center, the tip of the pelvic amplifier, and a theoretical point that represents a vertex horizontally aligned with the pelvis and vertically aligned with the hip amplifier. In other words, <span class="math inline">\(x_1y_1\)</span> describes the coordinates of “hipC” and <span class="math inline">\(x_2y_2\)</span> describes the coordinates of “hipR” in x and y pixels in the data above. So arranged, we have a right triangle with vertices described by the x and y pixels we have digitized with MTrackJ. With simple trigonometry, we can calculate <span class="math inline">\(\theta\)</span>. So please <strong>think about how to do this with calculations in R</strong>.</p>
<p>The goal here is to calculate <span class="math inline">\(\theta\)</span> over every frame. But we have a problem. Notice that the data, as presented above, don’t have the x and y pixels for each point aligned in unique rows according to each frame (“PID”). That is, the data are in a “long” format where the column “TID” (the point name) describes “PID” (the frame). Put another way, x and y pixel data are repeated in succession <em>down</em> the table for each point name. This makes calculations for frame-specific <span class="math inline">\(\theta\)</span>, which will presumably require using the x and y coordinates for three points, very cumbersome.</p>
<p>Not to worry, however. Data wonks are accustomed to this problem and we can simply transform the table to a “wide” format. By wide, we mean that, for each frame, we’ll have sepqrate x and y columns for each point name, making frame-specific calculations based on these points easy peasy.</p>
<p>Here’s how it’s done:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>walk.wide <span class="ot">&lt;-</span> walk.dat2<span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>TID,<span class="at">values_from=</span><span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(walk.wide)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
## # Groups:   speed, subject [1]
##     PID subject speed x_hipR x_hipC x_legR y_hipR y_hipC y_legR
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1 me      fast    200.   282.   185.   178.   167.  0.381
## 2     2 me      fast    200.   282.   186.   178.   168.  0.394
## 3     3 me      fast    200.   282.   186.   178.   168.  0.392
## 4     4 me      fast    200.   282.   186.   178.   168.  0.370
## 5     5 me      fast    199.   282.   186.   177.   168.  0.331
## 6     6 me      fast    199.   283.   187.   177.   168.  0.310</code></pre>
<p>Notice that we now have columns that are named as “x_” and “y_” with a point name suffix, i.e., we have taken the x and y column and made new ones based the point they describe. We have several new columns and fewer rows of course. For this we used <code>dplyr</code>’s <code>pivot_wider()</code> functions that, well, pivots long data to wide data. We told <code>pivot_wider()</code> to take the names from “TID” (the point names) to form the new columns with values from the columns named “x” and “y.” We could now compute <span class="math inline">\(\theta\)</span> for each PID (i.e., frame) based on the coordinates of each point.</p>
</div>
<div id="adding-references" class="section level2">
<h2>Adding references</h2>
<p>As we take on the rest of the mini-projexts, including this one, we’ll be reading scientific papers so that we can place our results in context. In addition, as scientists, we always want to support our statements of fact with references. For this, we’ll need to cite and include these papers in a bibliography.</p>
<p><a href="https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html">Adding reference to an .Rmd</a> is pretty straight forward. First we’ll need to establish a .bib file that will reside in the same directory as your .Rmd file. To do this, select “File-&gt;New File-&gt;Text File.” A new tab will appear with the name “Untitled1.txt.” Save this file as “BIOL5380.bib” (note the “.bib” extension) in the same directory as your .Rmd file. This .bib file will be referenced by your .Rmd when inserting citations.</p>
<p>The framework for citations and references in .Rmd is formulated around <a href="https://en.wikipedia.org/wiki/BibTeX">BibTex</a>. BibTex is handy because you can find BibTex formatted citations in all your typical outlets (see note below). This system of citation uses a .bib file that contains text describing published works. Each work or potential reference in the .bib file is identified with a unique tag at the top of its entry and this entry contains the important bibliographic information. For instance, a .bib file containing a reference to the following paper</p>
<p>Usherwood, J.R., 2005. Why not walk faster?. Biology Letters, 1(3), pp.338-341.</p>
<p>would have the following text:</p>
<pre><code>@article{usherwood2005not,
  title={Why not walk faster?},
  author={Usherwood, James Richard},
  journal={Biology Letters},
  volume={1},
  number={3},
  pages={338--341},
  year={2005}
}</code></pre>
<p>Notice we have a tag “@article{usherwood2005not,” This identifies the entry as a journal article (as apposed to a book or manual, etc.) and contains a key that is unique among all the other references in the .bib file. After this, the entry then goes on to identify the important bibliographic pieces: title, author, journal, etc.). Go ahead and add this BibTex reference to your BIOL5380.bib file and save it. For .Rmd to reference this .bib file, we need to specify a bibliography file in the YAML header. So now alter your YAML header at the top of the .Rmd so that it contains `bibliography: BIOL5380.bib”. The YAML header should now look something like this:</p>
<pre><code>---
title: &quot;Mini-Project 2&quot;
author: The Inverted Pendula
date: 26/Feb/2021
output: html_document
bibliography: BIOL5380.bib
---</code></pre>
<p>With a .bib file now in place, we can use the reference keys to cite works listed in the .bib file. For this, we simply add the key label to the text with ‘@.’ For instance, <code>@usherwood2005not</code> will produce <span class="citation">Usherwood (2005)</span>.</p>
<p>When citing published works in text, we often follow certain formatting conventions. To be honest, your professor couldn’t care less about which format gets used in your .Rmds. Fortunately, R Markdown uses a familiar <a href="https://www.citethisforme.com/harvard-referencing">Harvard-like</a> format by default and he recommends plowing ahead with it. In a Harvard-like format, a reference in a sentence used in an explicit manner includes the reference year in parentheses. For instance, if we were to express that these authors studied the the Froude number in humans, we would write, “Underwood (2005) studied the Froude number in human walking.” The reference <code>usherwood2005not</code> is just inserted at the beginning of the sentence as in the following:</p>
<pre><code>@usherwood2005not studied the Froude number in human walking.</code></pre>
<p>However, Harvard-like convention follows that if we aren’t explicit about the study, we include the entire reference in parentheses. For instance, if we wanted to write, “A recent study considered the Froude number in human walking. <span class="citation">(Usherwood 2005)</span>.” we would include the following:</p>
<pre><code>A recent study considered the Froude number in human walking. [@usherwood2005not].</code></pre>
<p>Note that <code>usherwood2005not</code> is wrapped in <code>[]</code>.</p>
<p>In R Markdown, bibliographies will be placed at the end of the document (see below). Normally, this means you want to end your document with the header “References.” This will anchor the bibliography in this section.</p>
<p>Note that this .bib file can be used in all your .Rmd documents, not just this one. As long as all the BibTex entries have unique keys, this .bib file can serve as a reference database for all your .Rmd citations.</p>
<div class="green">
<div class="row">
<div class="col-sm-2">
<a class="far fa-sticky-note fa-5x" style="color:#939681"></a> <!-- regular style -->
</div>
<div class="col-sm-9">
<p>You may be wondering where you can find BibTex citations. Like so much of our lives, the answer points to Google, specifically Google Scholar. As an example, go to <a href="http://scholar.google.com/">Google Scholar</a> and search for the <span class="citation">Usherwood (2005)</span> paper. The entry under scholar will look like the following:</p>
<p><img src="img/scholar1.png" /> <br></p>
<p>Click on the big <code>"</code> at the bottom of the entry. This will bring you to a pop-up window that contains different citation formats for the entry.</p>
<p><img src="img/scholar2.png" /> <br></p>
<p>Now click on the “BibTex” link at the bottom of the window. This will lead you to a text file of the BibTex format. Simply copy and paste this to your .bib file. Voila.</p>
</div>
</div>
</div>
<p><br></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-usherwood2005not" class="csl-entry">
Usherwood, James Richard. 2005. <span>“Why Not Walk Faster?”</span> <em>Biology Letters</em> 1 (3): 338–41.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
